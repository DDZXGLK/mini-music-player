import{_ as W,r as h,o as y,c as v,e as c,f as a,a as n,n as z,t as u,w as g,g as p,h as L,i as _,j as b,F as D,k as P,l as N,m as R,p as j,d as K}from"./index-3db5bb1e.js";function E(t){t=parseInt(t),t>1e4?t=Math.floor(t/1e3):t=Math.floor(t);let e=Math.floor(t/60),o=Math.floor(t%60);return e=e<10?"0"+e:e,o=o<10?"0"+o:o,e+":"+o}function V(t){if(!t)return[];try{return t.split(`
`).map(o=>{const r=/\[(\d+),(\d+)\]/,s=o.match(r);if(!s)return null;const[l,d,x]=s;if(isNaN(d)||isNaN(x))return null;const C=o.replace(r,"");if(!C)return null;const M=C.split(/(\([1-9]\d*,[1-9]\d*,\d*\)[^\(]*)/g).filter(m=>m.trim()).map(m=>{const w=/\((\d+),(\d+),(\d+)\)/,f=m.match(w);if(!f)return null;const[U,S,k]=f,i=m.replace(w,"");return i?{time:Number(S)/1e3+.1,duration:Number(k)/1e3,content:i}:null}).filter(m=>m);return{time:Number(d)/1e3,endTime:Number(x)/1e3,content:M}}).filter(o=>o)}catch(e){return console.error("逐字歌词处理出错："+e),[]}}const O={name:"Index",data(){return{defaultKeyWorlds:"",keywords:"",musicData:[],total:0,pageSize:20,current:1,audio:null,isPlay:!1,musicUrl:"",isRotate:!1,picUrl:"/img/default.jpg",musicName:"快来听歌呀~",singer:"网易云~",loopType:1,musicIdList:[],musicIdIndex:0,level:"standard",isLevel:!1,levelText:"标准",parsedLyrics:[],currentIndex:0,isLyrc:!1,voiceControlLeft:"35px",voiceSizeWidth:"50%",voiceControlflag:!1,isMute:!1,progressControlLeft:"-5px",progressWidth:0,progressControlflag:!1}},mounted(){this.getSearchDefault(),this.getAudio(),this.audio.volume=.5,document.body.addEventListener("mousemove",t=>{this.voiceControlflag&&this.voiceSize(t.clientX),this.progressControlflag&&this.progress(t.clientX)}),document.body.addEventListener("mouseup",()=>{this.voiceControlflag=!1,this.progressControlflag=!1}),this.audio.addEventListener("timeupdate",()=>{let t=this.audio.currentTime/this.audio.duration*100;this.progressControlLeft=t+"%",this.progressWidth=t+"%"})},methods:{getAudio(){this.audio=this.$refs.audio},time(t){return E(t)},rowStyle({row:t,rowIndex:e}){if(e%2==0)return{backgroundColor:"#d9ecff"}},getMusicList(){this.keywords||(this.keywords=this.defaultKeyWorlds),this.$http.get("/cloudsearch",{keywords:this.keywords,limit:this.pageSize,offset:(this.current-1)*this.pageSize,type:1}).then(t=>{t.code==200&&(this.musicData=t.result.songs,this.total=t.result.songCount)})},getSearchDefault(){this.$http.get("/search/default").then(t=>{if(t.code==200)return this.defaultKeyWorlds=t.data.realkeyword;this.$message.error(t.message)})},getSearchHot(t,e){if(t){let o=[];this.$http.get("/search/suggest",{keywords:t}).then(r=>{r.code==200&&(o=r.result.songs.map((s,l)=>{let d=s.artists.map(x=>x.name);return{index:l,value:d.join("、")+"-"+s.name}}),e(o))})}else{let o=[];this.$http.get("/search/hot/detail").then(r=>{r.code==200?(o=r.data.map((s,l)=>s={index:l,value:s.searchWord,score:s.score,content:s.content}),e(o)):this.$message.error("获取热搜列表失败！")})}},getMusicUrl(t,e){t||(e=0,t=this.musicData[e].id,this.musicIdList=this.musicData.map(r=>r.id),this.musicIdIndex=e);let o=this.musicData[e];this.picUrl=o.al.picUrl,this.musicName=o.name,this.singer=o.ar.map(r=>r.name).join("、"),this.$http.get("/song/url/v1",{id:t,level:this.level}).then(r=>{if(r.code==200){if(this.musicUrl=r.data[0].url,!this.musicUrl)return this.$message.warning("亲~暂时还没有歌曲链接呦~"),this.next();this.audio.addEventListener("canplay",()=>{this.audio.play(),this.isRotate=!0})}else this.$message.error(r.message)})},listen(t){this.isPlay=!0,this.musicIdList=this.musicData.map(e=>e.id),this.musicIdIndex=this.musicData.findIndex(e=>e.id==t.id),this.getMusicUrl(t.id,this.musicIdIndex),this.getLyric(),this.audio.addEventListener("ended",()=>{let e="";this.loopType==1&&(this.musicIdIndex<this.musicIdList.length-1?this.musicIdIndex=this.musicIdIndex+1:this.musicIdIndex=0),this.loopType==2&&(this.musicIdIndex=this.musicIdIndex),this.loopType==3&&(this.musicIdIndex=Math.floor(Math.random()*this.pageSize)),e=this.musicIdList[this.musicIdIndex],this.getMusicUrl(e,this.musicIdIndex),this.getLyric()})},play(){if(this.isPlay)this.isPlay=!1,this.isRotate=!1,this.audio.pause();else{if(!this.musicData.length)return this.$message.warning("当前播放列表为空!");if(this.isPlay=!0,!this.musicIdList.length)return this.getMusicUrl();this.audio.play(),this.isRotate=!0}},prev(){if(!this.musicData.length)return this.$message.warning("当前播放列表为空!");if(this.isPlay=!0,!this.musicIdList.length)return this.getMusicUrl();this.musicIdIndex==0?this.musicIdIndex=this.musicIdList.length-1:this.musicIdIndex--,this.getMusicUrl(this.musicIdList[this.musicIdIndex],this.musicIdIndex),this.getLyric()},next(){if(!this.musicData.length)return this.$message.warning("当前播放列表为空!");if(this.isPlay=!0,!this.musicIdList.length)return this.getMusicUrl();this.musicIdIndex<this.musicIdList.length-1?this.musicIdIndex++:this.musicIdIndex=0,this.getMusicUrl(this.musicIdList[this.musicIdIndex],this.musicIdIndex),this.getLyric()},switchLoopType(){this.loopType==1&&this.$nextTick(()=>{this.loopType=2}),this.loopType==2&&this.$nextTick(()=>{this.loopType=3}),this.loopType==3&&this.$nextTick(()=>{this.loopType=1})},switchQuality(t){t.target.innerText=="标准"&&(this.level="standard",this.levelText="标准"),t.target.innerText=="较高"&&(this.level="higher",this.levelText="较高"),t.target.innerText=="极高"&&(this.level="exhigh",this.levelText="极高"),t.target.innerText=="无损"&&(this.level="lossless",this.levelText="无损"),this.musicIdList.length&&this.musicIdIndex+1&&this.getMusicUrl(this.musicIdList[this.musicIdIndex],this.musicIdIndex)},changeIslyrc(){this.isLyrc=!this.isLyrc,this.getLyric()},getLyric(){if(this.isLyrc){if(!this.musicData.length)return this.$message.warning("当前播放列表为空!");this.musicIdList.length&&this.musicIdIndex+1?this.$http.get("/lyric/new",{id:this.musicIdList[this.musicIdIndex]}).then(t=>{var o;if(!((o=t.yrc)!=null&&o.lyric))return this.isLyrc=!1,this.$message.warning("暂无歌词!");const e=t.yrc.lyric;this.audio.addEventListener("timeupdate",()=>{this.parsedLyrics=V(e),this.currentIndex=this.findIndex()})}):this.$message.warning("暂无歌曲播放!")}else this.audio.removeEventListener("timeupdate",()=>{this.currentIndex=this.findIndex()})},findIndex(){let t=this.audio.currentTime;for(let e=0;e<this.parsedLyrics.length;e++)if(t<this.parsedLyrics[e].time)return e-1<0?0:e-1;return this.parsedLyrics.length-1},voiceControlClick(t){this.voiceSize(t.clientX)},voiceControlMousedown(t){this.voiceControlflag=!0,this.voiceSize(t.clientX)},voiceSize(t){let e=this.$refs.voiceControlbg.getBoundingClientRect(),o=t-e.left,r=e.right-e.left;o/r>1?(this.audio.volume=1,this.voiceControlLeft=r+"px",this.voiceSizeWidth="100%"):o/r<0?(this.audio.volume=0,this.voiceControlLeft=+"px",this.voiceSizeWidth="0%"):(this.audio.volume=o/r,this.voiceControlLeft=o+"px",this.voiceSizeWidth=this.audio.volume*100+"%")},mute(){this.isMute=!this.isMute,this.audio.muted=!this.audio.muted},progressControlMousedown(t){this.progressControlflag=!0,this.progress(t.clientX)},progress(t){if(!this.audio.duration)return this.progressControlflag=!1,this.$message.warning("暂无歌曲播放!");let e=this.$refs.progressControlbg.getBoundingClientRect(),o=t-e.left,r=e.right-e.left,s=this.audio.duration;o/r>1?(this.audio.currentTime=s,this.progressControlLeft=r-5+"px",this.progressWidth="100%"):o/r<0?(this.audio.currentTime=0,this.progressControlLeft=0,this.progressWidth=0):(this.audio.currentTime=o/r*s,this.progressControlLeft=o+"px",this.progressWidth=o/r*100+"%")}},computed:{currentLyricIndex(){let t=this.parsedLyrics[this.currentIndex].content,e;for(let o=0;o<t.length;o++){if(t[o].time<this.audio.currentTime&&this.audio.currentTime<t[o].time+t[o].duration){e=o;break}this.audio.currentTime<t[0].time&&(e=-1),this.audio.currentTime>t[t.length-1].time&&(e=t.length-1)}return e}}},I=t=>(j("data-v-a13f7dc9"),t=t(),K(),t),X={class:"music"},B={class:"hot"},Q={class:"name"},q={key:0,class:"content"},A={class:"musicPlayer"},F={class:"left"},H=["src"],Y={class:"musicInfo"},G={class:"musicName"},J={class:"singer"},Z={class:"control"},$=I(()=>n("i",{class:"iconfont icon-xunhuan"},null,-1)),ee=[$],te=I(()=>n("i",{class:"iconfont icon-suiji"},null,-1)),ie=[te],se=I(()=>n("i",{class:"iconfont icon-shangyishou"},null,-1)),oe=[se],le=I(()=>n("i",{class:"iconfont icon-bofang"},null,-1)),ne=[le],re=I(()=>n("i",{class:"iconfont icon-zantingtingzhi"},null,-1)),ce=[re],ue=I(()=>n("i",{class:"iconfont icon-xiayishou"},null,-1)),de=[ue],he={class:"right"},ae=I(()=>n("i",{class:"iconfont icon-yinliang"},null,-1)),ge=[ae],pe=["src"],me={key:0,class:"lyrc"};function fe(t,e,o,r,s,l){var k;const d=h("el-col"),x=h("el-autocomplete"),C=h("Search"),M=h("el-button"),m=h("el-row"),w=h("el-empty"),f=h("el-table-column"),U=h("el-table"),S=h("el-pagination");return y(),v("div",X,[c(m,null,{default:a(()=>[c(d,{span:6}),c(d,{span:8},{default:a(()=>[c(x,{placeholder:s.defaultKeyWorlds?s.defaultKeyWorlds:"请输入歌曲信息",modelValue:s.keywords,"onUpdate:modelValue":e[0]||(e[0]=i=>s.keywords=i),"fetch-suggestions":l.getSearchHot,clearable:"",onKeyup:R(l.getMusicList,["enter"])},{default:a(({item:i})=>[n("div",B,[n("div",{class:z(["No",i.index==0?"No1":i.index==1?"No2":i.index==2?"No3":""])},u(i.index+1),3),n("div",null,[n("div",Q,[_(u(i.value),1),n("span",null,u(i.score),1)]),i.content?(y(),v("div",q,u(i.content),1)):N("",!0)])])]),_:1},8,["placeholder","modelValue","fetch-suggestions","onKeyup"])]),_:1}),c(d,{span:4},{default:a(()=>[c(M,{type:"primary",onClick:l.getMusicList},{default:a(()=>[c(C,{style:{width:"1em",height:"1em"}}),_("搜索 ")]),_:1},8,["onClick"])]),_:1}),c(d,{span:6})]),_:1}),c(U,{data:s.musicData,border:"","row-style":l.rowStyle,rowKey:"id","max-height":"600","highlight-current-row":"",onRowDblclick:l.listen,getSelectionRows:""},{empty:a(()=>[c(w,{description:"暂无数据"})]),default:a(()=>[c(f,{type:"index",width:"50"}),c(f,{label:"音乐标题",prop:"name"}),c(f,{label:"歌手"},{default:a(i=>[_(u(i.row.ar.map(T=>T.name).join("、")),1)]),_:1}),c(f,{label:"专辑",prop:"al.name"}),c(f,{label:"时长"},{default:a(i=>[_(u(l.time(i.row.dt)),1)]),_:1})]),_:1},8,["data","row-style","onRowDblclick"]),c(S,{background:"",total:s.total,"page-size":s.pageSize,"onUpdate:pageSize":[e[1]||(e[1]=i=>s.pageSize=i),l.getMusicList],"current-page":s.current,"onUpdate:currentPage":[e[2]||(e[2]=i=>s.current=i),l.getMusicList],"page-sizes":[10,20,30,40,50],layout:"total, sizes, prev, pager, next, jumper"},null,8,["total","page-size","current-page","onUpdate:currentPage","onUpdate:pageSize"]),n("div",null,[n("div",A,[n("div",F,[n("img",{class:z(["pic",{rotate:s.isRotate}]),src:s.picUrl},null,10,H),n("div",Y,[n("div",G,u(s.musicName),1),n("div",J,u(s.singer),1)])]),n("div",Z,[g(n("div",{class:"loop",style:{background:"url('/img/shunxu.png')"},onClick:e[3]||(e[3]=L((...i)=>l.switchLoopType&&l.switchLoopType(...i),["stop"]))},null,512),[[p,s.loopType==1]]),g(n("div",{class:"loop",onClick:e[4]||(e[4]=L((...i)=>l.switchLoopType&&l.switchLoopType(...i),["stop"]))},ee,512),[[p,s.loopType==2]]),g(n("div",{class:"loop",onClick:e[5]||(e[5]=L((...i)=>l.switchLoopType&&l.switchLoopType(...i),["stop"]))},ie,512),[[p,s.loopType==3]]),n("div",{class:"prev",onClick:e[6]||(e[6]=(...i)=>l.prev&&l.prev(...i))},oe),g(n("div",{class:"play",onClick:e[7]||(e[7]=(...i)=>l.play&&l.play(...i))},ne,512),[[p,!s.isPlay]]),g(n("div",{class:"pause",onClick:e[8]||(e[8]=(...i)=>l.play&&l.play(...i))},ce,512),[[p,s.isPlay]]),n("div",{class:"next",onClick:e[9]||(e[9]=(...i)=>l.next&&l.next(...i))},de),n("div",{class:"lyric",style:{width:"30px",height:"30px",background:"url('/img/lyric.png')"},onClick:e[10]||(e[10]=(...i)=>l.changeIslyrc&&l.changeIslyrc(...i))})]),n("div",he,[n("div",{class:"quality",onClick:e[15]||(e[15]=i=>s.isLevel=!s.isLevel)},[_(u(s.levelText)+" ",1),g(n("div",{class:"qualityOptions",onClick:e[11]||(e[11]=i=>l.switchQuality(i))},"标准",512),[[p,s.isLevel]]),g(n("div",{class:"qualityOptions",onClick:e[12]||(e[12]=i=>l.switchQuality(i))},"较高",512),[[p,s.isLevel]]),g(n("div",{class:"qualityOptions",onClick:e[13]||(e[13]=i=>l.switchQuality(i))},"极高",512),[[p,s.isLevel]]),g(n("div",{class:"qualityOptions",onClick:e[14]||(e[14]=i=>l.switchQuality(i))},"无损",512),[[p,s.isLevel]])]),s.isMute?(y(),v("div",{key:1,class:"voice",onClick:e[17]||(e[17]=(...i)=>l.mute&&l.mute(...i)),style:{width:"16px",height:"16px",background:"url('/img/jingyin.png')"}})):(y(),v("div",{key:0,class:"voice",onClick:e[16]||(e[16]=(...i)=>l.mute&&l.mute(...i))},ge)),n("div",{ref:"voiceControlbg",class:"voiceControlbg",onClick:e[19]||(e[19]=i=>l.voiceControlClick(i))},[n("div",{ref:"voiceControl",style:b({left:s.voiceControlLeft}),class:"voiceControl",onMousedown:e[18]||(e[18]=L(i=>l.voiceControlMousedown(i),["stop"]))},null,36),n("div",{class:"voiceSize",style:b({width:s.voiceSizeWidth})},null,4)],512)])]),n("div",{ref:"progressControlbg",class:"progressbg",onClick:e[21]||(e[21]=i=>l.progress(i.clientX))},[n("div",{ref:"progressControl",style:b({left:s.progressControlLeft}),class:"progressControl",onMousedown:e[20]||(e[20]=L(i=>l.progressControlMousedown(i),["stop"]))},null,36),n("div",{class:"progress",style:b({width:s.progressWidth})},null,4)],512)]),n("audio",{ref:"audio",src:s.musicUrl},null,8,pe),s.isLyrc?(y(),v("div",me,[(y(!0),v(D,null,P((k=s.parsedLyrics[this.currentIndex])==null?void 0:k.content,(i,T)=>(y(),v("span",{class:z(["text",{active:T<=l.currentLyricIndex}]),key:T},u(i.content),3))),128))])):N("",!0)])}const ve=W(O,[["render",fe],["__scopeId","data-v-a13f7dc9"]]);export{ve as default};
